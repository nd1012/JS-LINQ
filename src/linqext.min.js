/**
 * LINQ array extensions
 * 
 * @github https://github.com/nd1012/JS-LINQ
 * @license MIT
 * @copyright (c)2022 Andreas Zimmermann, wan24.de
 */class LinqArrayExt extends LinqArray{InnerJoin(a,b,c,d=null,e=null){return b=LinqArray.Helper.EnsureValueGetter(b),c=LinqArray.Helper.EnsureValueGetter(c),d||(d=(c,a)=>({...c,...a})),this.Join(a,b,c,d,e)}LeftJoin(a,b,c,d,e=null){return b=LinqArray.Helper.EnsureValueGetter(b),c=LinqArray.Helper.EnsureValueGetter(c),a=LinqArray.Helper.EnsureLinqArray(a,!0),a.GroupJoin(this,b,c,(c,a)=>{c,a},e).SelectMany(a=>a.b,(c,a)=>d(c.a,a))}RightJoin(a,b,c,d,e=null){return b=LinqArray.Helper.EnsureValueGetter(b),c=LinqArray.Helper.EnsureValueGetter(c),a=LinqArray.Helper.EnsureLinqArray(a,!0),a.GroupJoin(this,c,b,(c,a)=>{c,a},e).SelectMany(a=>a.b,(c,a)=>d(a,c.a))}FullJoin(a,b,c,d,e,f=null){return b=LinqArray.Helper.EnsureValueGetter(b),c=LinqArray.Helper.EnsureValueGetter(c),a=LinqArray.Helper.EnsureLinqArray(a,!0),this.LeftJoin(a,b,c,d,f).Union(this.RightJoin(a,b,c,e,f))}CrossJoin(a,b){return this.Join(a,a=>a,a=>a,b,()=>!0)}Partition(a){return this.SelectMany(b=>b.Zip(LinqArray.Range(1,b.length),(b,c)=>({...b,[a]:c})))}Pivot(a,...b){const c=this,d=a?{[a.key]:null}:{};a&&(a.data??=a=>a.GroupKey),b=new LinqArray(b).ForEach(a=>{if(a.key??=a=>a.GroupKey,null==a.group?d[a.key]=null:a.groups=c.GroupBy(a.group).OrderBy(a=>a.GroupKey,null,!0).ForEach(b=>d[a.key(b)]=null),LinqArray.Helper.IsFunction(a.data))return;const b=a.data;a.data=a=>a.Sum(a=>+a[b])});const e=null==a?null:this.GroupBy(a.group??a.key).Select(c=>{const e=Object.assign({},d,{[a.key]:a.data(c)});return b.ForEach(a=>(null==a.group?e[a.key]=a.data(c):c.GroupBy(a.group).ForEach(b=>e[a.key(b)]=a.data(b)),!0)),e});if(e&&!a.summary)return e;const f=Object.assign({},d);return b.ForEach(a=>(null==a.group?f[a.key]=a.data(c):a.groups.ForEach(b=>f[a.key(b)]=a.data(b)),!0)),e?.Append(f)??f}MovingAverage(a=0){return this.EnsureGenerated().length?this.reduce((a,b)=>(a+b)/2,a):a}MovingAverages(a=0){return this.Select(b=>a=(a+b)/2)}TakeEvery(a){let b=0;return this.Where(()=>++b==a?!(b=0):!b)}TakeRandom(){const a=this.EnsureGenerated().length;if(!a)throw new RangeError;return this.ElementAt(Math.floor(Math.random()*a))}FallbackIfEmpty(a){return this.IsEmpty()?LinqArray.Helper.IsFunction(a)?a():a:this}Shuffle(a=!1){return this.OrderBy(()=>Math.random(),null,a)}Doubles(a=null){return this.GroupBy(a).Where(a=>1<a.length)}Replace(a,b=null,c=null,d=!1){const e=this,f=LinqArray.Helper.IsFunction(a),g=LinqArray.Helper.IsFunction(b),h=d?null:this._CreateGenerated(function*(){let d,i=0;for(d of e._Iterable)(f&&a(d)||!f&&(c?c(a,d):a==d))&&(h[i]=g?b(d):b),i++}());if(d){let d,e=0;for(d of this._Iterable)(f&&a(d)||!f&&(c?c(a,d):a==d))&&(this._Iterable[e]=g?b(d):b),e++}return h??this}constructor(a=null,b=!0,c=!1){super(a,b,c)}static FromCsv(a,b=!0,d=",",e="\"",f=null){var g=Math.max;return a.endsWith("\n")||(a+="\n"),new this().Generate(function*(){let g,h,i,j,k=[g=""],l=!0,m=h=0;for(i of a){if(i==e)(l=!l)||i!=g||(k[h]+=i);else if(l&&i==d)i=k[++h]="";else if(l&&"\n"==i){if("\r"==g&&(k[h]=k[h].slice(0,-1)),b?!0===b&&(b=k,k=null):b=LinqArray.Range(0,k.length).ToArray(),k){if(k.length!=b.length)throw new RangeError("Invalid row #"+m+" length (expected "+b.length+" fields, got "+k.length+"): "+JSON.stringify(k));for(j={},h=0;h<k.length;j[b[h]]=k[h],h++);yield f?f(j,b):j}k=[i=""],h=0,m++}else k[h]+=i;g=i}}(),g(0,a.trim().split("\n").length-(b?1:0)))}static FromXml(a){return this.FromDomNode(new DOMParser().parseFromString(a,"application/xml").firstChild)}static FromDomNode(a){const b=a=>{if(!a.childNodes.length)return a.textContent;const c={};let d;for(d of a.childNodes)c[d.nodeName]=d.childNodes.length?b(a):a.textContent;return c};return new this().Generate(function*(){for(var c in a.childNodes)yield b(c)},a.childNodes.length)}static Fibonacci(a=0,b=1){return new this().Generate(function*(){for(let c=a+b;;a=b,b=c,c=a+b)yield c}(),Number.POSITIVE_INFINITY).DisableStore()}static RandomInt(a=_NumberMIN_SAFE_INTEGER,b=_NumberMAX_SAFE_INTEGER){var c=Math.ceil;Number.MAX_SAFE_INTEGER;Number.MIN_SAFE_INTEGER;var d=Math.floor;return a=c(a),b=d(b),new this().Generate(function*(){for(;;)yield d(Math.random()*(b-a))+a}(),Number.POSITIVE_INFINITY).DisableStore()}static RandomArbitrary(a=Number.MIN_VALUE,b=Number.MAX_VALUE){return new this().Generate(function*(){for(;;)yield Math.random()*(b-a)+a}(),Number.POSITIVE_INFINITY).DisableStore()}static PivotRowColumn(a,b=!1,c=null,d=null){return{key:a,group:c,data:d,summary:b}}static PivotGroupColumn(a,b,c){return{key:c,group:a,data:b}}static PivotCalcColumn(a,b){return{key:a,group:null,data:b}}}window&&(window.From=(a,b=!0,c=!1)=>LinqArrayExt.From(a,b,c));