/**
 * LINQ array extensions
 * 
 * @github https://github.com/nd1012/JS-LINQ
 * @license MIT
 * @copyright (c)2022 Andreas Zimmermann, wan24.de
 */class LinqArrayExt extends LinqArray{InnerJoin(a,b,c,d=null,e=null){return b=LinqArray.Helper.EnsureValueGetter(b),c=LinqArray.Helper.EnsureValueGetter(c),d||(d=(c,a)=>({...c,...a})),this.Join(a,b,c,d,e)}LeftJoin(a,b,c,d,e=null){return b=LinqArray.Helper.EnsureValueGetter(b),c=LinqArray.Helper.EnsureValueGetter(c),a=LinqArray.Helper.EnsureLinqArray(a,!0),a.GroupJoin(this,b,c,(c,a)=>{c,a},e).SelectMany(a=>a.b,(c,a)=>d(c.a,a))}RightJoin(a,b,c,d,e=null){return b=LinqArray.Helper.EnsureValueGetter(b),c=LinqArray.Helper.EnsureValueGetter(c),a=LinqArray.Helper.EnsureLinqArray(a,!0),a.GroupJoin(this,c,b,(c,a)=>{c,a},e).SelectMany(a=>a.b,(c,a)=>d(a,c.a))}FullJoin(a,b,c,d,e,f=null){return b=LinqArray.Helper.EnsureValueGetter(b),c=LinqArray.Helper.EnsureValueGetter(c),a=LinqArray.Helper.EnsureLinqArray(a,!0),this.LeftJoin(a,b,c,d,f).Union(this.RightJoin(a,b,c,e,f))}CrossJoin(a,b){return this.Join(a,a=>a,a=>a,b,()=>!0)}Partition(a){return this.SelectMany(b=>b.Zip(LinqArray.Range(1,b.length),(b,c)=>({...b,[a]:c})))}Pivot(a,...b){const c=this,d=a?{[a.key]:null}:{};a&&(a.data??=a=>a.GroupKey),b=new LinqArray(b).ForEach(a=>{if(a.key??=a=>a.GroupKey,null==a.group?d[a.key]=null:a.groups=c.GroupBy(a.group).OrderBy(a=>a.GroupKey,null,!0).ForEach(b=>d[a.key(b)]=null),LinqArray.Helper.IsFunction(a.data))return;const b=a.data;a.data=a=>a.Sum(a=>+a[b])});const e=null==a?null:this.GroupBy(a.group??a.key).Select(c=>{const e=Object.assign({},d,{[a.key]:a.data(c)});return b.ForEach(a=>(null==a.group?e[a.key]=a.data(c):c.GroupBy(a.group).ForEach(b=>e[a.key(b)]=a.data(b)),!0)),e});if(e&&!a.summary)return e;const f=Object.assign({},d);return b.ForEach(a=>(null==a.group?f[a.key]=a.data(c):a.groups.ForEach(b=>f[a.key(b)]=a.data(b)),!0)),e?.Append(f)??f}MovingAverage(a=0){return this.EnsureGenerated().length?this.reduce((a,b)=>(a+b)/2,a):a}MovingAverages(a=0){return this.Select(b=>a=(a+b)/2)}TakeEvery(a){let b=0;return this.Where(()=>++b==a?!(b=0):!b)}TakeRandom(){const a=this.EnsureGenerated().length;if(!a)throw new Error("No items");return this[Math.floor(Math.random()*a)]}FallbackIfEmpty(a){return this.IsEmpty()?LinqArray.Helper.IsFunction(a)?a():a:this}Shuffle(a=!1){return this.OrderBy(()=>Math.random(),null,a)}Doubles(a=null){return this.GroupBy(a).Where(a=>1<a.length)}Replace(a,b=null,c=null,d=!1){const e=this,f=LinqArray.Helper.IsFunction(a),g=LinqArray.Helper.IsFunction(b),h=d?null:this._CreateGenerated(function*(){let d,i=0;for(d of e)(f&&a(d)||!f&&(c?c(a,d):a==d))&&(h[i]=g?b(d):b),i++}());if(d){let d,e=0;for(d of this)(f&&a(d)||!f&&(c?c(a,d):a==d))&&(this[e]=g?b(d):b),e++}return h??this}constructor(a=null,b=!0,c=!1){super(a,b,c)}static FromCsv(a,b=!0,d=",",e="\"",f=null){var g=Math.max;return a.endsWith("\n")||(a+="\n"),new this().Generate(function*(){let g,h,i,j=[g=""],k=0,l=!0,m=0;for(h of a){if(h==e)(l=!l)||h!=g||(j[k]+=h);else if(l&&h==d)h=j[++k]="";else if(l&&"\n"==h){if("\r"==g&&(j[k]=j[k].slice(0,-1)),b?!0===b&&(b=j,j=null):b=LinqArray.Range(0,j.length).ToArray(),j){if(j.length!=b.length)throw new Error("Invalid row #"+m+" length (expected "+b.length+" fields, got "+j.length+"): "+JSON.stringify(j));for(i={},k=0;k<j.length;i[b[k]]=j[k],k++);yield f?f(i,b):i}j=[h=""],k=0,m++}else j[k]+=h;g=h}}(),g(0,a.trim().split("\n").length-(b?1:0)))}static PivotRowColumn(a,b=!1,c=null,d=null){return{key:a,group:c,data:d,summary:b}}static PivotGroupColumn(a,b,c){return{key:c,group:a,data:b}}static PivotCalcColumn(a,b){return{key:a,group:null,data:b}}}window&&(window.From=(a,b=!0,c=!1)=>LinqArrayExt.From(a,b,c));