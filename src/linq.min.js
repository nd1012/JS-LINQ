/**
 * An array with LINQ-like methods
 * 
 * @github https://github.com/nd1012/JS-LINQ
 * @license MIT
 * @copyright (c)2022 Andreas Zimmermann, wan24.de
 */class LinqArray extends Array{static#VERSION=0;static#Helper={IsLinqArray:e=>e instanceof LinqArray,EnsureLinqArray:(e,n=!1)=>e instanceof LinqArray?e:new LinqArray().SetAllData(e,n),EnsureFinalArray:e=>e instanceof LinqArray?e.EnsureGenerated():e,GetArrayLength:e=>e instanceof LinqArray?e.EnsureGenerated()._Iterable.length:e.length,IsUndefined:e=>"undefined"==typeof e,IsFunction:e=>"function"==typeof e,IsString:e=>"string"==typeof e,DefaultOrdering:(e,n,r=!1)=>{switch(!0){case"string"==typeof e:const t=e.localeCompare(n?.toString());switch(!0){case 0>t:return r?1:-1;case 0<t:return r?-1:1;default:return 0;}case e<n:return r?1:-1;case e>n:return r?-1:1;default:return 0;}},DefaultComparing:(e,n,r=!1)=>r?e===n:0==LinqArray.Helper.DefaultOrdering(e,n),EnsureValueGetter:e=>"function"==typeof e?e:n=>n[e]};#Parent=null;#OrderAction=null;#Ordering=null;#OrderDescending=null;#GroupKey=void 0;#Generator=null;#IsGenerated=!0;#IsDynamic=!1;#EstimatedCount=null;#Store=!0;#Iterated=!1;#PassStore=!1;#Extended=null;#Tag=null;static get VERSION(){return LinqArray.#VERSION}static get Helper(){return LinqArray.#Helper}get Parent(){return this.#Parent}get GroupKey(){return this.#GroupKey}get IsGenerated(){return this.#IsGenerated}get IsDynamic(){return this.#IsDynamic}get Store(){return this.#Store}get PassStore(){return this.#PassStore}get Extended(){return this.#Extended}get _Iterable(){return this.#IsDynamic?this:this.#Extended??this}get Tag(){return this.#Tag}set Tag(e){this.#Tag=e}get Type(){return"LinqArray"}get SupportsDynamic(){for(let e=this;e;e=e.Parent)if(!e.Store)return!1;return!0}Count(e=null){if(!e){if(null!=this.#EstimatedCount)return this.#EstimatedCount;if(this.#Extended)return this.#Extended.length;if(this.#IsGenerated)return this.length;if(!this.#Store&&this.#Iterated)throw new TypeError}return e?this.Aggregate((n,r,t)=>e(r,t,n)?++n:n,0):this.Aggregate(e=>++e,0)}async CountAsync(e){return await this.AggregateAsync(async(n,r,t)=>(await e(r,t))?++n:n,0)}IsEmpty(){return this._GetIterator().next().done}Contains(e,n=null){if(!n)if(this.#IsGenerated&&this.#Store)return this.includes(e);else{if(this.#Iterated)throw new TypeError;if(!this.#IsGenerated&&this.#Store)return this.EnsureGenerated().includes(e);let n;for(n of this._GetIterator())if(n==e)return!0;return!1}let r;for(r of this._GetIterator())if(n(r,e))return!0;return!1}Join(e,n,r,t,d=null){const u=this;return n=LinqArray.Helper.EnsureValueGetter(n),r=LinqArray.Helper.EnsureValueGetter(r),LinqArray.Helper.IsLinqArray(e)&&e._EnsureFinite(),this._EnsureFinite()._CreateGenerated(function*(){let s,l,o,G,_=0;for(l of u._GetIterator()){s=n(l,_),G=0;for(o of e)(d?!!d(s,r(o,G)):s==r(o,G))&&(yield t(l,o,_,G),G++);_++}})}GroupJoin(e,n,r,t,a=null){const d=this._EnsureFinite();return n=LinqArray.Helper.EnsureValueGetter(n),r=LinqArray.Helper.EnsureValueGetter(r),e=LinqArray.Helper.EnsureLinqArray(e,!0)._EnsureFinite(),this._CreateGenerated(function*(){let u,s,l,o,G,_=0;for(l of d._GetIterator()){u=n(l,_),s=e.Where((e,n)=>a?a(u,r(e,n)):u==r(e,n)),G=0;for(o of e)yield t(l,s,u,_,G),G++;_++}})}Where(e){const n=this;return this._CreateGenerated(function*(){let r,t=0;for(r of n._GetIterator())e(r,t)&&(yield r),t++})}async WhereAsync(e){const n=new this.constructor;return n.#Parent=this,await this.ForEachAsync(async(r,t)=>{(await e(r,t))&&n.push(r)}),n}All(e){let n;for(n of this._EnsureFinite()._GetIterator())if(!e(n))return!1;return!0}async AllAsync(e){let n;for await(n of this._EnsureFinite()._GetIterator())if(!(await e(n)))return!1;return!0}Any(e=null){if(!e)return!this.IsEmpty();let n;for(n of this._GetIterator())if(e(n))return!0;return!1}async AnyAsync(e){let n;for(n of this._GetIterator())if(await e(n))return!0;return!1}Distinct(e=null){const n=this;return this._CreateGenerated(function*(){const r=new LinqArray;let t;for(t of n._GetIterator())r.Contains(t,e)||(yield t,r.push(t))})}DistinctBy(e,n=null){const r=this;return e=LinqArray.Helper.EnsureValueGetter(e),this._CreateGenerated(function*(){const t=new LinqArray;let a,i,d=0;for(i of r._GetIterator())a=e(i,d),d++,t.Contains(a,n)||(yield i,t.push(a))})}Union(e,n=null,r=!1){if(this._EnsureFinite().#IsDynamic)if(r){const r=this.#Generator;return this.#Generator=function*(){let t,a=new LinqArray;for(t of r())yield t,a.push(t);for(t of e)a.Contains(t,n)||(yield t,a.push(t))},this}else{const r=this;return this._CreateInstance().GenerateDynamic(function*(){let t,a=new LinqArray;for(t of r)yield t,a.push(t);for(t of e)a.Contains(t,n)||(yield t,a.push(t))})}const t=r?this.EnsureGenerated():this.EnsureGenerated().slice(),a=new LinqArray(t.slice());return r||(t.#Parent=this),t.#IsGenerated=!1,t.#Generator=function*(){let r;for(r of e)a.Contains(r,n)||(yield r,a.push(r))}(),t}UnionBy(e,n,r=null,t=!1){if(n=LinqArray.Helper.EnsureValueGetter(n),this._EnsureFinite().#IsDynamic)if(t){const t=this.#Generator;return this.#Generator=function*(){let a,i,d=new LinqArray,u=0;for(a of t())yield a,d.push(n(a)),u++;for(a of e)i=n(a,u),u++,d.Contains(i,r)||(yield a,d.push(i))},this}else{const t=this;return this._CreateInstance().GenerateDynamic(function*(){let a,i,d=new LinqArray,u=0;for(a of t)yield a,d.push(n(a)),u++;for(a of e)i=n(a,u),u++,d.Contains(i,r)||(yield a,d.push(i))})}const a=t?this.EnsureGenerated():this.EnsureGenerated().slice(),i=new LinqArray(a.slice());return t||(a.#Parent=this),a.#IsGenerated=!1,a.#Generator=function*(){let t,a,d=0;for(t of e)a=n(t,d),d++,i.Contains(a,r)||(yield t,i.push(a))}(),a}Select(e){const n=this;return e=LinqArray.Helper.EnsureValueGetter(e),this._CreateGenerated(function*(){let r,t=0;for(r of n._GetIterator())yield e(r,t),t++},this.TryGetNonEnumeratedCount())}async SelectAsync(e){const n=new this.constructor;return n.#Parent=this,await this.ForEachAsync(async(r,t)=>n.push(await e(r,t))),n}SelectMany(e,n=null){const r=this;return e=LinqArray.Helper.EnsureValueGetter(e),this._CreateGenerated(function*(){let t,a,d,u,s=0;if(n){for(t of r._GetIterator()){for(a of e(t,s)){u=0;for(d of a)yield n(d,a,s,u),u++}s++}return}for(t of r._GetIterator()){for(d of e(t,s))yield d;s++}})}async SelectManyAsync(e,n=null){const r=new this.constructor;r.#Parent=this;let t,a,d;return await this.ForEachAsync(async(i,u)=>{if(n){for(t of await e(i,u)){d=0;for(a of t)r.push(await n(a,t,u,d)),d++}return}for(a of await e(i,u))r.push(a)}),r}Zip(e,n=null){var r=Math.min;LinqArray.Helper.IsLinqArray(e)&&e._EnsureFinite();const t=this._EnsureFinite(),a=LinqArray.Helper.IsFunction(n),d=!a&&null!=n,u=LinqArray.Helper.GetArrayLength(e),s=d?LinqArray.Helper.GetArrayLength(n):null;this.EnsureGenerated(null==s?u:r(u,s));const l=d?r(this._Iterable.length,u,s):r(this._Iterable.length,u);return this._CreateGenerated(function*(){for(let r=0;r<l;r++)d?yield[t[r],e[r],n[r]]:a?yield n(t[r],e[r],r):yield[t[r],e[r]]}(),l)}OfType(e,n=!1){const r=LinqArray.Helper.IsString(e),t=r&&!n?e.toLowerCase():e;return r?this.Where(e=>typeof e==t||(n?e?.constructor?.name:e?.constructor?.name?.toLowerCase())===t):this.Where(r=>r instanceof e&&(!n||r.constructor.name===e.name))}NotOfType(e,n=!1){const r=LinqArray.Helper.IsString(e),t=r&&!n?e.toLowerCase():e;return r?this.Where(e=>typeof e!=t&&(n?e?.constructor?.name:e?.constructor?.name?.toLowerCase())!==t):this.Where(r=>!(r instanceof e)||n&&r.constructor.name!==e.name)}Except(e,n=null){const r=this,t=LinqArray.Helper.IsLinqArray(e);return t&&e._EnsureFinite(),this._CreateGenerated(function*(){let a;for(a of r._GetIterator())(n?t?!e.Any(e=>n(a,e)):!e.some(e=>n(a,e)):t?!e.Contains(a):!e.includes(a))&&(yield a)})}ExceptBy(e,n,r=null){const t=this,a=LinqArray.Helper.IsLinqArray(e);return a&&e._EnsureFinite(),n=LinqArray.Helper.EnsureValueGetter(n),this._CreateGenerated(function*(){let i,d,u=0;for(d of t._GetIterator())i=n(d,u),(r?a?!e.Any(e=>r(i,n(e))):!e.some(e=>r(i,n(e))):a?!e.Any(e=>i==n(e)):!e.some(e=>i==n(e)))&&(yield d),u++}())}Intersect(e,n=null){const r=this._EnsureFinite();return this._CreateGenerated(function*(){n&&(e=LinqArray.Helper.EnsureLinqArray(e)._EnsureFinite());const t=r.TryGetNonEnumeratedCount(),i=LinqArray.Helper.GetArrayLength(e),d=null!=t&&null!=i&&t<i?r:e,a=d==r?e:r,u=LinqArray.Helper.IsLinqArray(a);let s;for(s of d)(u?a.Any(e=>n(s,e)):a.includes(s))&&(yield s)})}IntersectBy(e,n,r=null){const t=this._EnsureFinite();return n=LinqArray.Helper.EnsureValueGetter(n),this._CreateGenerated(function*(){const i=t.TryGetNonEnumeratedCount();let d,u,s=0;if(LinqArray.Helper.IsLinqArray(e)){e._EnsureFinite();const l=e.TryGetNonEnumeratedCount(),o=null!=i&&null!=l&&i<l?t:e,a=o==t?e:t;for(u of o)d=n(u,s),(r?a.Any(e=>r(d,n(e))):a.Any(e=>d==n(e)))&&(yield u),s++;return}const l=e.length,o=null!=i&&null!=l&&i<l?t:e,a=o==t?e:t,G=LinqArray.Helper.IsLinqArray(a);for(u of o)d=n(u,s),(r?G?a.Any(e=>r(d,n(e))):a.some(e=>r(d,n(e))):G?a.Any(e=>d==n(e)):a.some(e=>d==n(e)))&&(yield u),s++})}First(e=null){if(!e){const e=this._GetIterator().next();if(e.done)throw new RangeError;return e.value}let n,r=0;for(n of this._GetIterator()){if(e(n,r))return n;r++}throw new RangeError}async FirstAsync(e){let n,r=0;for(n of this._GetIterator()){if(await e(n,r))return n;r++}throw new RangeError}FirstOrDefault(e,n=null){if([e,n]=this.#EnsureActionOrDefaultResult(e,n),!e){const e=this._GetIterator().next();return e.done?n:e.value}let r,t=0;for(r of this._GetIterator()){if(e(r,t))return r;t++}return n}async FirstOrDefaultAsync(e,n=null){let r,t=0;for(r of this._GetIterator()){if(await e(r,t))return r;t++}return n}Last(e=null){let n,r=0;if(this.#IsDynamic){let t,a=!1;for(n of this){if(e&&!e(n,r)){r++;continue}t=n,a=!0,r++}if(!a)throw new RangeError;return t}if(!e){const e=this.EnsureGenerated()._Iterable.length;if(!e)throw new RangeError;return this._Iterable[e-1]}for(n of this.EnsureGenerated().slice().reverse()){if(e(n,r))return n;r++}throw new RangeError}async LastAsync(e){let n,r=0;if(this.#IsDynamic){let t,a=!1;for(n of this){if(!(await e(n,r))){r++;continue}t=n,a=!0,r++}if(!a)throw new RangeError;return t}for(n of this.EnsureGenerated().slice().reverse()){if(await e(n,r))return n;r++}throw new RangeError}LastOrDefault(e,n=null){[e,n]=this.#EnsureActionOrDefaultResult(e,n);let r,t=0;if(this.#IsDynamic){for(r of this)(!e||e(r,t))&&(n=r),t++;return n}if(!e)return this.EnsureGenerated()._Iterable.length?this._Iterable[this._Iterable.length-1]:n;for(r of this.EnsureGenerated().slice().reverse()){if(!e||e(r,t))return r;t++}return n}async LastOrDefaultAsync(e,n=null){let r,t=0;if(this.#IsDynamic)return await this.ForEachAsync(async(r,t)=>{(await e(r,t))&&(n=r)}),n;for(r of this.EnsureGenerated().slice().reverse()){if(await e(r,t))return r;t++}return n}Single(e=null){if(this._EnsureFinite().#IsDynamic){const n=(e?this.Where(e):this).Take(2).ToArray();switch(n.length){case 0:throw new RangeError;case 1:return n[0];default:throw new RangeError("Many items");}}else if(!e)switch(this.EnsureGenerated(2)._Iterable.length){case 0:throw new RangeError;case 1:return this.First();default:throw new RangeError("Many items");}let n,r=!1;if(this.ForEach((t,a)=>{if(e(t,a)){if(r)throw new RangeError("Many items");n=t,r=!0}}),!r)throw new RangeError;return n}async SingleAsync(e){if(this._EnsureFinite().#IsDynamic){const n=(await this.WhereAsync(e)).Take(2).ToArray();switch(n.length){case 0:throw new RangeError;case 1:return n[0];default:throw new RangeError("Many items");}}let n,r=!1;if(await this.ForEachAsync(async(t,a)=>{if(await e(t,a)){if(r)throw new RangeError("Many items");n=t,r=!0}}),!r)throw new RangeError;return n}SingleOrDefault(e,n=null){let r=!1;return this.ForEach((t,a)=>{if(!e||e(t,a)){if(r)throw new RangeError("Many items");n=t,r=!0}}),n}async SingleOrDefaultAsync(e,n=null){let r=!1;return await this.ForEachAsync(async(t,a)=>{if(await e(t,a)){if(r)throw new RangeError("Many items");n=t,r=!0}}),n}ElementAt(e){var n=Number.isFinite;if(this.#IsDynamic||null!=this.#EstimatedCount&&!n(this.#EstimatedCount)){let n,r=0;for(n of this){if(r==e)return n;r++}throw new RangeError}if(0>e&&(e=this.Count()-e),this.EnsureGenerated(e+1),0>e||e>=this._Iterable.length)throw new RangeError;return this._Iterable[e]}ElementAtOrDefault(e,n=null){var r=Number.isFinite;if(this.#IsDynamic||null!=this.#EstimatedCount&&!r(this.#EstimatedCount)){let r,t=0;for(r of this){if(t==e)return r;t++}return n}return 0>e&&(e=this.Count()-e),this.EnsureGenerated(e+1),0>e||e>=this._Iterable.length?n:this._Iterable[e]}DefaultIfEmpty(e){return this._GetIterator().next().done?this._CreateInstance([e]):this}OrderBy(e=null,n=null,r=!1){return this.#_OrderBy(e,n,r,!1)}OrderByDescending(e=null,n=null,r=!1){return this.#_OrderBy(e,n,r,!0)}#_OrderBy(e,n,r,t){if(r&&this._EnsureFinite().#IsDynamic)throw new TypeError("Is dynamic");null!=e&&(e=LinqArray.Helper.EnsureValueGetter(e)),n??=LinqArray.Helper.DefaultOrdering;const a=r?this.EnsureGenerated():this.EnsureGenerated().slice();r||(a.#Parent=this),a.#OrderAction=e,a.#Ordering=n,a.#OrderDescending=t;let i=0;return a.sort(e?(r,a)=>{let d=n(e(r,i),e(a,i),t,r,a);return i++,d}:(e,r)=>n(e,r,t,e,r))}ThenBy(e,n=null){return this.#_ThenBy(e,n,!1)}ThenByDescending(e,n=null){return this.#_ThenBy(e,n,!0)}#_ThenBy(e,n,r){if(null==this.#Ordering)return this.#_OrderBy(e,n,!1,r);const t=this,a=(e,r,a,i,d)=>{const u=t.#OrderAction?t.#Ordering(t.#OrderAction(i),t.#OrderAction(d),t.#OrderDescending,i,d):t.#Ordering(i,d,t.#OrderDescending,i,d);return 0==u?n(e,r,a,i,d):u};return e=LinqArray.Helper.EnsureValueGetter(e),n??=LinqArray.Helper.DefaultOrdering,this.#_OrderBy(e,a,!1,r)}GroupBy(n=null,r=null){this._EnsureFinite();const t=new Map;let a,i;null!=n&&(n=LinqArray.Helper.EnsureValueGetter(n)),this.ForEach((e,d)=>{a=n?n(e,d):e,t.has(a)?t.get(a).push(r?r(e,d):e):(t.set(a,i=new this.constructor().AppendThis(r?r(e,d):e)),i.#Parent=this,i.#GroupKey=a)});const d=new this.constructor(Array.from(t.values()));return d.#Parent=this,d}async GroupByAsync(n=null,r=null){this._EnsureFinite();const t=new Map;let a,i;null!=n&&(n=LinqArray.Helper.EnsureValueGetter(n)),await this.ForEachAsync(async(e,d)=>{a=n?await n(e,d):e,t.has(a)?t.get(a).push(r?await r(e,d):e):(t.set(a,i=new this.constructor().AppendThis(r?await r(e,d):e)),i.#Parent=this,i.#GroupKey=a)});const d=new this.constructor(Array.from(t.values()));return d.#Parent=this,d}TryGetNonEnumeratedCount(){return this.#IsGenerated&&!this.#IsDynamic?this._Iterable.length:this.#EstimatedCount}Skip(e=1){if(0>e)return this.SkipLast(+e);if(1>e)return this.ToLinqArray();const n=this;return this._CreateGenerated(function*(){const r=n._GetIterator();let t;for(;e&&!(t=r.next()).done;e--);t.done||(yield*r)})}SkipLast(e=1){if(!e)return this.ToLinqArray();const n=this._EnsureFinite();return this.#IsDynamic?this._CreateGenerated(function*(){const r=n._EnsureFinite().DisableDynamic(!1).EnsureGenerated();e<r.length&&(yield*r.Take(r.length-e)._GetIterator())}):e=this.EnsureGenerated()._Iterable.length-e?this._CreateGenerated(function*(){const r=n._GetIterator();for(let n;e&&!(n=r.next()).done;e--)yield n.value}(),Math.max(0,this._Iterable.length-e)):this._CreateInstance()}SkipWhile(e){const n=this;return this._CreateGenerated(this.#IsDynamic?function*(){yield*n.GetWhenNot(e)}:this.GetWhenNot(e))}async SkipWhileAsync(e){const n=new this.constructor;n.#Parent=this;let r;for await(r of this.GetWhenNotAsync(e))n.push(r);return n}*GetWhenNot(e){const n=this._GetIterator();let r,t=0;for(r=n.next();!r.done&&e(r.value,t);r=n.next(),t++);r.done||(yield r,yield*n)}async*GetWhenNotAsync(e){const n=this._GetIterator();let r,t=0;for(r=n.next();!r.done&&(await e(r.value,t));r=n.next(),t++);r.done||(yield r,yield*n)}Take(e){if(0>e)return this.TakeLast(+e);if(1>e)return this._CreateInstance();const n=this,r=this.TryGetNonEnumeratedCount();return this._CreateGenerated(function*(){const r=n._GetIterator();for(let n;e&&!(n=r.next()).done;e--)yield n},null==r?null:Math.max(0,Math.min(r,e)))}TakeLast(e){if(!e)return this._CreateInstance();if(this._EnsureFinite().#IsDynamic){const n=this;return this._CreateGenerated(function*(){const r=[];let t;for(t of n)r.push(t),r.length>e&&r.shift();yield*r[Symbol.iterator]()})}const n=this.EnsureGenerated()._Iterable.length;switch(!0){case!n:return this._CreateInstance();case n<e:return this.ToLinqArray();default:return this.Skip(n-e);}}TakeWhile(e){const n=this;return this._CreateGenerated(this.#IsDynamic?function*(){yield*n.GetWhile(e)}:this.GetWhile(e))}async TakeWhileAsync(e){const n=new this.constructor;n.#Parent=this;let r;for await(r of this.GetWhileAsync(e))n.push(r);return n}*GetWhile(e){const n=this._GetIterator();for(let r=n.next(),t=0;!r.done&&e(r.value,t);r=n.next(),t++)yield r.value}async*GetWhileAsync(e){const n=this._GetIterator();for(let r=n.next(),t=0;!r.done&&(await e(r.value,t));r=n.next(),t++)yield r.value}Append(...e){return this.AppendAll(e)}AppendAll(e){const n=this._EnsureFinite(),r=!this.#IsDynamic&&(!LinqArray.Helper.IsLinqArray(e)||e.IsGenerated),t=r?this.TryGetNonEnumeratedCount():null;return this._CreateGenerated(function*(){const r=n._GetIterator();let t;for(t of r)yield t;yield*e[Symbol.iterator]()},null==t?null:t+e.length)}AppendThis(...e){return this.AppendAllThis(e)}AppendAllThis(e){if(this._EnsureFinite().#IsDynamic){const n=this.#Generator;return this.#Generator=function*(){let r;for(r of n())yield r;yield*e[Symbol.iterator]()},this}const n=!LinqArray.Helper.IsLinqArray(e)||e.IsGenerated;return n&&!e.length?this:(this.EnsureGenerated().#IsGenerated=!1,this.#Generator=function*(){yield*e[Symbol.iterator]()}(),this.#EstimatedCount=n?this._Iterable.length+e.length:null,this)}Prepend(...e){return this.PrependAll(e)}PrependAll(e){const n=this,r=LinqArray.Helper.IsLinqArray(e),t=!this.#IsDynamic&&(!r||e.IsGenerated),a=t?this.TryGetNonEnumeratedCount():null;return r&&e._EnsureFinite(),this._CreateGenerated(function*(){let r;for(r of e)yield r;yield*n._GetIterator()},null==a?null:a+e.length)}PrependThis(...e){return this.PrependAllThis(e)}PrependAllThis(e){const n=LinqArray.Helper.IsLinqArray(e);if(n&&e._EnsureFinite(),this.#IsDynamic){const n=this.#Generator;return this.#Generator=function*(){let r;for(r of e[Symbol.iterator])yield r;yield*n()},this}const r=LinqArray.Helper.GetArrayLength(e);return r?(this.EnsureGenerated().unshift(...e),this.#IsGenerated||null==this.#EstimatedCount||(this.#EstimatedCount+=r),this):this}Concat(...e){return this.ConcatAll(e)}ConcatAll(e){const n=this._EnsureFinite(),r=this._CreateGenerated(function*(){let t,a;for(t of n._GetIterator())yield t;n.#IsDynamic||e.some(e=>LinqArray.Helper.IsLinqArray(e)&&!e.IsGenerated)||(r.#EstimatedCount=r.length+e.map(e=>e.length).reduce((e,n)=>e+n,0));for(a of e){LinqArray.Helper.IsLinqArray(a)&&a._EnsureFinite();for(t of a)yield t}});return r}ConcatThis(...e){return this.ConcatAllThis(e)}ConcatAllThis(e){if(this._EnsureFinite().#IsDynamic){const n=this.#Generator;return this.#Generator=function*(){let r,t;for(r of n())yield r;for(t of e)for(r of t)yield r},this}return this.EnsureGenerated().#IsGenerated=!1,this.#Generator=function*(){let n,r;for(n of e){LinqArray.Helper.IsLinqArray(n)&&n._EnsureFinite();for(r of n)yield r}}(),this.#EstimatedCount=e.some(e=>LinqArray.Helper.IsLinqArray(e)&&!e.IsGenerated)?null:this._Iterable.length+e.map(e=>e.length).reduce((e,n)=>e+n,0),this}Chunk(e){const n=this,r=this.TryGetNonEnumeratedCount();return this._CreateGenerated(function*(){const r=n._GetIterator();for(let t,a={done:!1};!a.done;){for(t=[];t.length<e&&!(a=r.next()).done;t.push(a.value));t.length&&(yield n._CreateInstance(t))}},null==r?null:Math.ceil(r/e))}Reverse(e=!1){const n=this._EnsureFinite();if(this.#Extended){if(e){for(let e=this.#Extended.length,n=this.ToArray(),r=0;0<=e;this[r]=n[e],e--,r++);return this}else{let e=new this.constructor().Generate(function*(){for(let e=n.#Extended.length-1;0<=e;e--)yield n[e]}());return e.#Parent=this,e}}else if(this.#IsDynamic){if(e)throw new TypeError;return this._CreateGenerated(function*(){yield*n.ToArray().reverse()[Symbol.iterator]()})}let r=e?this.EnsureGenerated().reverse():this.EnsureGenerated().slice().reverse();return r.#Parent=this,r}Max(e=null){if(this._EnsureFinite().#IsDynamic){null!=e&&(e=LinqArray.Helper.EnsureValueGetter(e));let n,r,t=!1;if(this.ForEach((a,i)=>{r=e?e(a,i):a,t&&r<=n||(n=r,t=!0)}),!t)throw new RangeError;return n}switch(this.EnsureGenerated()._Iterable.length){case 0:throw new RangeError;case 1:return this.First();default:return Math.max(...(null==e?this:this.Select(e)));}}MaxBy(e){var n=Number.MAX_VALUE;if(e=LinqArray.Helper.EnsureValueGetter(e),this._EnsureFinite().#IsDynamic){let n,r,t,a=!1;if(this.ForEach((i,d)=>{t=e(i,d),a&&t<=r||(n=i,r=t,a=!0)}),!a)throw new RangeError;return n}switch(this.EnsureGenerated()._Iterable.length){case 0:throw new RangeError;case 1:return this.First();}let r,t,a,i=null,d=0;for(a of this._GetIterator()){if(t=e(a,d),t==n)return a;if(null!=i&&t<=i){d++;continue}i=t,r=a,d++}return r}Min(e=null){if(this._EnsureFinite().#IsDynamic){null!=e&&(e=LinqArray.Helper.EnsureValueGetter(e));let n,r,t=!1;if(this.ForEach((a,i)=>{r=e?e(a,i):a,t&&r>=n||(n=r,t=!0)}),!t)throw new RangeError;return n}switch(this.EnsureGenerated()._Iterable.length){case 0:throw new RangeError;case 1:return this.First();default:return Math.min(...(null==e?this:this.Select(e)));}}MinBy(e){var n=Number.MIN_VALUE;if(e=LinqArray.Helper.EnsureValueGetter(e),this._EnsureFinite().#IsDynamic){let n,r,t,a=!1;if(this.ForEach((i,d)=>{t=e(i,d),a&&t>=r||(n=i,r=t,a=!0)}),!a)throw new RangeError;return n}switch(this.EnsureGenerated()._Iterable.length){case 0:throw new RangeError;case 1:return this.First();}let r,t,a,i=null,d=0;for(a of this._GetIterator()){if(t=e(a,d),t==n)return a;if(null!=i&&t>=i){d++;continue}i=t,r=a,d++}return r}Sum(e=null){return null!=e&&(e=LinqArray.Helper.EnsureValueGetter(e)),this._EnsureFinite().#IsDynamic?this.Aggregate((n,r,t)=>n+(e?e(r,t):r),0):(null==e?this:this.Select(e)).EnsureGenerated().reduce((e,n)=>e+n,0)}Average(e=null){const n=this.Sum(e),r=this._Iterable.length;return r?n/r:0}SequenceEqual(e,n=null,r=!1){const t=this._EnsureFinite()._GetIterator(),i=e[Symbol.iterator]();let d,u;for(d=t.next(),u=i.next();!d.done&&!u.done;d=t.next(),u=i.next())if(n?!n(d.value,u.value,r):r?d.value!==u.value:d.value!=u.value)return!1;return d.done==u.done}Aggregate(e,n=void 0,r=null){const t=!LinqArray.Helper.IsUndefined(n);if(!this._EnsureFinite().#IsDynamic){const a=this.EnsureGenerated()._Iterable.length;if(!a){if(!t)throw new RangeError;return r?r(n):n}if(t)this.ForEach((r,t)=>n=e(n,r,t));else{if(1==a)return r?r(this._Iterable[0]):this._Iterable[0];let t=!0;this.ForEach((r,a)=>{t?(n=r,t=!1):n=e(n,r,a)})}}else if(t)this.ForEach(r=>n=e(n,r));else{let r=!0;if(this.ForEach((t,a)=>{r?(n=t,r=!1):n=e(n,t,a)}),r)throw new RangeError}return r?r(n):n}async AggregateAsync(e,n=void 0,r=null){const t=!LinqArray.Helper.IsUndefined(n);if(!this._EnsureFinite().#IsDynamic){const r=this.EnsureGenerated()._Iterable.length;if(!r){if(!t)throw new RangeError;}else if(t)await this.ForEachAsync(async(r,t)=>n=await e(n,r,t));else if(1==r)n=this._Iterable[0];else{let r=!0;await this.ForEachAsync(async(t,a)=>{r?(n=t,r=!1):n=await e(n,t,a)})}}else if(t)await this.ForEachAsync(async(r,t)=>n=await e(n,r,t));else{let r=!0;if(await this.ForEachAsync(async(t,a)=>{r?(n=t,r=!1):n=await e(n,t,a)}),r)throw new RangeError}return r?await r(n):n}*Execute(e){let n,r=0;for(n of this._GetIterator())yield e(n,r),r++}async*ExecuteAsync(e){let n,r=0;for(n of this._GetIterator())yield await e(n,r),r++}ForEach(e,n=!0){const r=this;if(n){let n,r=0;for(n of this._GetIterator()){if(!1===e(n,r))break;r++}}return n?this:this._CreateGenerated(function*(){let n,t=0;for(n of r._GetIterator()){if(!1===e(n,t))break;yield n,t++}})}async ForEachAsync(e){let n,r=0;for(n of this._GetIterator()){if(!1===(await e(n,r)))break;r++}return this}ToArray(e=null,n=!1){if(!n)return null==e?[...this._EnsureFinite()]:this.Take(e).ToArray();if(null!=e)return this.Take(e).ToArray(null,!0);const r=[...this._EnsureFinite()],t=r.length;let a,d;for(let u=0;u<t;u++)if(LinqArray.Helper.IsLinqArray(r[u]))r[u]=r[u].ToArray(null,!0);else if("object"==typeof r[u])for([a,d]of Object.entries(r[u]))LinqArray.Helper.IsLinqArray(d)&&(r[u][a]=r[u][a].ToArray(null,!0));return r}ToList(e=null){return this.ToArray(e)}ToDictionary(e,n=null){const r=this._EnsureFinite();return e=LinqArray.Helper.EnsureValueGetter(e),new Map(function*(){let t,a,i=0;for(a of r._GetIterator())t=e(a),yield[t,n?n(a,t,i):a],i++}())}ToHashSet(e=null){const n=this._EnsureFinite();null!=e&&(e=LinqArray.Helper.EnsureValueGetter(e));const r=new Set(e?function*(){let t,a=0;for(t of n._GetIterator())yield e?e(t,r,a):t,a++}():this);return r}ToLookup(e,n=null){this._EnsureFinite();const r=new Map;let t,a;return null!=e&&(e=LinqArray.Helper.EnsureValueGetter(e)),this.ForEach((i,d)=>{t=e?e(i,d):i,a=n?n(i,d):i,r.has(t)?r.get(t).push(a):r.set(t,[a])}),r}ToLinqArray(e=null){return e?this.Take(e):this.#IsDynamic?this._CreateInstance().GenerateDynamic(this.#Generator):this._CreateInstance(this)}ToDynamic(){return this.#IsDynamic?this._CreateInstance().GenerateDynamic(this.#Generator):this._EnsureFinite().EnsureGenerated()._CreateInstance().SetDynamicData(this.ToArray())}ToJson(){return JSON.stringify({Type:this.Type,GroupKey:this.GroupKey,Tag:this.Tag,Items:this.ToArray(null,!0)})}EnsureGenerated(e=null){if(this._EnsureFinite().#IsDynamic)throw new TypeError("Is dynamic");if(this.#Extended||this.#IsGenerated||!this.#Generator||e&&this.length>=e)return this;if(!this.#Store)throw new TypeError("Storing was disabled");const n=this.#Generator;let r=null;for(let t=e??0;(!e||t)&&!(r=n.next()).done;this.push(r.value),t--);return!r?.done&&1?this:(this.#Generator=null,this.#IsGenerated=!0,this.#EstimatedCount=null,this)}Finalize(){if(this.#Store)return this.EnsureGenerated();const e=this._EnsureFinite().#IsDynamic?this.#Generator():this.#Generator;if(this.#IsGenerated||!e)return this;for(;!e.next().done;);return this.#IsDynamic?this:(this.#Generator=null,this.#IsGenerated=!0,this.#EstimatedCount=null,this)}SetData(...e){return this.SetAllData(e)}SetAllData(e,n=!1){return this.Clear(),n?(this.#IsGenerated=!1,this.#EstimatedCount=LinqArray.Helper.IsLinqArray(e)?e.TryGetNonEnumeratedCount():e.length,this.#Generator=function*(){yield*e[Symbol.iterator]()}()):(LinqArray.Helper.IsLinqArray(e)&&e._EnsureFinite(),this.push(...e)),this}SetDynamicData(e){return this.GenerateDynamic(function*(){yield*e[Symbol.iterator]()})}Clear(e=!1){return!this.#Extended&&this.length&&(this.length=0),e&&(this.#Parent=null),this.#OrderAction=null,this.#Ordering=null,this.#OrderDescending=null,this.#GroupKey=void 0,this.#IsGenerated=!0,this.#IsDynamic=!1,this.#EstimatedCount=null,this.#Generator=null,this.#Store=!this.#Extended,this.#Iterated=!1,this}DisableStore(e=!1){if(!this.#Store)throw new TypeError("Storing is disabled already");if(this.length)throw new TypeError("Stored already");return this.#Store=!1,this.#PassStore=e,this}DisableDynamic(e=!0){if(!this.#IsDynamic)throw new TypeError("Not dynamic");return e?(this.#Generator=this.#Generator(),this.#IsDynamic=!1,this.#Store=!0,this.#PassStore=!1,this):this._CreateInstance().Generate(this.#Generator())}Generate(e,n=null){return this.Clear().#IsGenerated=!1,this.#Generator=e,this.#EstimatedCount=n,this}GenerateDynamic(e){return this.Generate(e).#IsDynamic=!0,this.#Store?this.DisableStore():this}_CreateInstance(e=null){const n=new this.constructor(e);return n._SetParent(this),this.#PassStore&&n.DisableStore(!0),n}_CreateGenerated(e,n=null){const r=this._CreateInstance();return this.#IsDynamic&&"Generator"==e.constructor.name?r.GenerateDynamic(e):r.Generate(e(),n),r._SetParent(this)}_GetIterator(){return this.#IsDynamic?this.#Generator():this._Iterable[Symbol.iterator]()}_SetGroupKey(e){return this.#GroupKey=e,this}_SetParent(e){return this.#Parent=e,this}_EnsureFinite(){if(null!=this.#EstimatedCount&&!Number.isFinite(this.#EstimatedCount))throw new TypeError("Is not finite");return this}#EnsureActionOrDefaultResult(e,n){if(LinqArray.Helper.IsUndefined(e))throw new TypeError("Action or default result required");return LinqArray.Helper.IsFunction(e)||(n=e,e=null),[e,n]}*[Symbol.iterator](){if(this.#IsDynamic)return void(yield*this.#Generator());if(this.#Extended)return void(yield*this.#Extended[Symbol.iterator]());const e=this.#Generator,n=this.#Store?super[Symbol.iterator]():null;if(!e){if(!this.#Store)throw new TypeError("Iterated already - buffer is disabled");return void(yield*n)}let r=0;if(n)for(let e=n.next();!e.done;e=n.next(),r++)yield e.value;for(let n=e.next();!n.done;n=e.next(),r++)this.#Store?this.push(n.value):this.#Iterated=!0,yield n.value;this.#Generator=null,this.#IsGenerated=!0,this.#EstimatedCount=this.#Store||this.#IsDynamic?null:r}constructor(e=null,n=!0,r=!1){if(super(),n||this.DisableStore(r),!!e){const n=LinqArray.Helper.IsLinqArray(e),r=n?e.TryGetNonEnumeratedCount():e.length;(n||r)&&(this.#IsGenerated=!1,this.#Generator=function*(){yield*e[Symbol.iterator]()}(),this.#EstimatedCount=r)}}static From(e,n=!0,r=!1){return new this(e,n,r)}static FromJson(e){if(LinqArray.Helper.IsString(e)&&(e=JSON.parse(e)),"object"!=typeof e)throw new TypeError;const n=new Function("data","return new "+e.Type+"(data);")(e.Items);return n._SetGroupKey(e.GroupKey).Tag=e.Tag,n}static async FromJsonUri(e){const n=await(await fetch(e)).json();return n instanceof Array?new this(n):this.FromJson(n)}static Range(e,n,r=!0,t=!1){const a=new this(null,r,t);return a.#IsGenerated=!1,a.#Generator=function*(){if(e<n)for(let r=e;r<n;r++)yield r;else for(let r=e;r>n;r--)yield r}(),a.#EstimatedCount=e<n?n-e:e-n,a}static Empty(){return new this}static Repeat(n,e,r=!0,t=!1){const a=new this(null,r,t),d=LinqArray.Helper.IsFunction(n);return a.#IsGenerated=!1,a.#Generator=function*(){for(let r=0;r<e;r++)yield d?n(r,a):n}(),a.#EstimatedCount=e,a}static async RepeatAsync(n,e){const r=new this;for(let t=0;t<e;r.push(await n(t,r)),t++);return r}static ExtendArray(){const e=this;Array.prototype.ToLinqArray=function(n=null){return new e(n?this.slice(0,n):this)}}static ExtendObject(e){if(e instanceof LinqArray)return e;if(!LinqArray.Helper.IsFunction(e[Symbol.iterator]))throw new TypeError("Object is not iterable");if(LinqArray.Helper.IsUndefined(e.length))throw new TypeError("Object needs a length property");const n=new this(e,!1),r=new Map(Object.entries(e));let t,a;n.#Extended=e;for([t,a]of Object.entries(n))!/^[_|\#|a-z]/.test(t)&&LinqArray.Helper.IsFunction(a)&&"AsyncFunction"!=a.constructor.name&&"GeneratorFunction"!=a.constructor.name&&!r.kas(t)&&a.prototype instanceof LinqArray&&(e[t]=(...e)=>n[t](...e));return n}}window&&LinqArray.Helper.IsUndefined(window.From)&&(window.From=(e,n=!0,r=!1)=>LinqArray.From(e,n,r)),window&&"document"in window&&!LinqArray.Helper.IsUndefined(window.PLinq)&&(PLinq.TypeInfo.LinqArray=document.currentScript.src);